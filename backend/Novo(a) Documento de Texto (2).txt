<%@ LANGUAGE="VBSCRIPT" %>
<%
	'-----------------------------------------------------------
	'-  Parametrização - Automatização Prévia 
	'-  Autor: Rodrigo Monteiro
	'-  Criação: 24/04/2025
	'-----------------------------------------------------------

	option explicit

	dim txt_usuario, txt_senha, txt_ip, txt_modulo,txt_sistema
	dim txt_msg, txt_subtitulo,rsPesquisa
	dim num_tabindex
	dim oPesquisa,ind_tipo_reembolso,ind_tipo_submodalidade,ind_tipo_submodalidade_filtro
	dim rsCombo, cod_operadora,txt_disabled, ind_filtrar
	dim cod_procedimento, dt_inicio, dt_fim,nome_item
	dim qtd_param, ind_acao
		
	txt_usuario             = Session("ace_usuario")
	txt_senha               = Session("ace_senha")
	txt_ip                  = Session("ace_ip")
	txt_sistema             = session("ace_sistema")

	if trim(txt_modulo) = "" then
		txt_modulo = Request.QueryString("pm")
		Session("ace_modulo") = txt_modulo
	end if

	txt_msg       = Session("txt_msg")
	txt_subtitulo = Request.QueryString("PT")

	Session("txt_msg")     = ""	
	session("pgm_retorno") = Request.ServerVariables("SCRIPT_NAME") & "?pt=" & txt_subtitulo
	
	cod_procedimento 		= Request("item_medico")
	nome_item 				= Request("nome_item_medico")
	ind_tipo_reembolso 		= Request("ind_tipo_reembolso")
	ind_tipo_submodalidade  = Request("ind_tipo_submodalidade")
	ind_tipo_submodalidade_filtro  = Request("ind_tipo_submodalidade_filtro")
	cod_operadora 			= Request("cod_operadora")
	dt_inicio 				= Request("p_dt_ini")
	dt_fim 					= Request("p_dt_fim")
	ind_filtrar 			= Request("ind_filtrar")

	num_tabindex = 0
%>

<html>
<head>
<title><%=Application("app")%></title>
<link href="\gen\css\css002.css" rel="stylesheet" type="text/css">

<!-- CALENDARIO INICIO -->
<link rel="stylesheet" type="text/css" media="all" href="\gen\css\calendar-green.css" title="green" />
<script type="text/javascript" src="\gen\js\calendar.js"></script>
<script type="text/javascript" src="\gen\js\calendar-br.js"></script>
<script type="text/javascript" src="\gen\js\calendar-setup.js"></script>
<!-- CALENDARIO FIM -->

<!--#include file=..\..\gen\asp\gen0202a.asp-->

<!--#include file=..\..\gen\inc\inc0000.asp-->
<!--#include file=..\..\gen\inc\inc0001.asp-->
<!--#include file=..\..\gen\inc\inc0002.asp-->

<!--Include do recordset oracle-->
<!--#include file=..\..\gen\asp\gen0146a.asp-->
<!--#include file=..\..\gen\asp\gen0146b.asp-->

<script src="../../gen/inc/inc0000_new.js" type="text/javascript"></script>
<script type="text/javascript" src="../../gen/modal/modal.crossbrowser.min.js"></script>
<script src="\gen\js\waitbar.js" type="text/javascript"></script>

<script language="JavaScript">

function ValidaForm() {
	
	var dtFinalAnterior; 
	var dtInicialNova; 
	var linhaBranca;
	
	for(var i=1; form01.qtd_param.value >= i ; i++){
		linhaBranca = "N";
		if (document.getElementById('cod_procedimento_'+i).value == ""){
			if (!confirm("Existe uma linha em branco. Deseja excluir?")) {
                try{document.getElementById('cod_procedimento_'+i).focus();}catch(e){};
				return false;
            } else {
				linhaBranca = "S";
			}
		}
		if (linhaBranca == "N") {
			if (document.getElementById('ind_tipo_reembolso_'+i).value == ""){
				alert("Obrigatório informar modalidade da prévia.");
				try{document.getElementById('ind_tipo_reembolso_'+i).focus();}catch(e){};
				return false;
			}
			
				if (document.getElementById('ind_tipo_submodalidade_'+i).value == ""){
				alert("Obrigatório informar a submodalidade da prévia.");
				try{document.getElementById('ind_tipo_submodalidade_'+i).focus();}catch(e){};
				return false;
			}
			if (document.getElementById('cod_tratamento_'+i).value == ""){
				alert("Obrigatório informar tipo de atendimento da prévia.");
				try{document.getElementById('cod_tratamento_'+i).focus();}catch(e){};
				return false;
			}
			if (document.getElementById('dt_inicio_'+i).value == ""){
				alert("Obrigatório informar data início de vigência");
				try{document.getElementById('dt_inicio_'+i).focus();}catch(e){};
				return false;
			}

			for(var j=1; i > j ; j++){
				if (document.getElementById('cod_procedimento_'+i).value == document.getElementById('cod_procedimento_'+j).value){
					if ((document.getElementById('ind_tipo_reembolso_'+i).value == document.getElementById('ind_tipo_reembolso_'+j).value) && 
						(document.getElementById('ind_tipo_submodalidade_'+i).value == document.getElementById('ind_tipo_submodalidade_'+j).value) &&
						(document.getElementById('cod_tratamento_'+i).value == document.getElementById('cod_tratamento_'+j).value) &&
						(document.getElementById('cod_operadora_'+i).value == document.getElementById('cod_operadora_'+j).value)){
						if (document.getElementById('dt_fim_'+j).value != "") {
						    
							dtFinalAnterior = converterData(document.getElementById('dt_fim_'+j).value);
						    dtInicialNova = converterData(document.getElementById('dt_inicio_'+i).value);
							
							if(dtFinalAnterior >= dtInicialNova){
								alert("Permitido cadastrar o mesmo procedimento apenas se a data de inicio for superior a data fim anterior.");
								try{document.getElementById('cod_procedimento_'+i).focus();}catch(e){};
								return false;
							}								
						} else {
							alert("Já existe um procedimento cadastrado com os mesmos parâmetros em vigência.");
							try{document.getElementById('cod_procedimento_'+i).focus();}catch(e){};
							return false;
						}
					}
				}
			}
		}
	}
    return true;
}
//----------------------------------------------------------------------------------
function buscarFiltro() {

	document.form01.ind_filtrar.value = 'S';
	document.form01.action = "<%=session("pgm_retorno")%>";
    document.form01.submit();
}
//--------------------------------------------------------------------------------------------------
function acao_continuar() {
    if (ValidaForm()) {
        document.form01.action = 'rbm1091b.asp?PT=<%=txt_subtitulo%>';
		document.form01.submit();
	}
}
//-----------------------------------------------------------------------------
function PesquisaProcedimento() {
	
	sChamada =  '/GEN/ASP/GEN0060a_ora_crossbrowser.asp';
    sChamada += '?ind_tipo_pesquisa=TODOS';
    sChamada += '&indsubmit=False';
    sChamada += '&txt_nome_campo_cod=item_medico';
    sChamada += '&txt_nome_campo_desc=nome_item_medico';
    sChamada += '&abre_modal=S';
    sChamada += '&ind_autorizacao=S';
    sChamada += '&ind_exibe_pacotes=S';        
	sChamada += '&funcao_executar=CarregaProcedimentoPesquisa()';

	AbrePesquisaCrossBrowser(sChamada, 'Pesquisa_Todos', 'Procedimento/Serviço', 700, 500, 20, 15, 'S')
}
//--------------------------------------------------------------------------------
function CarregaProcedimentoPesquisa (){
	CarregaProcedimento(form01.item_medico.value,'');
}
//--------------------------------------------------------------------------------
function PesquisaProcedimentoGrid(pLinha) {

	sChamada =  '/GEN/ASP/GEN0060a_ora_crossbrowser.asp';
    sChamada += '?ind_tipo_pesquisa=TODOS';
    sChamada += '&indsubmit=False';
    sChamada += '&txt_nome_campo_cod=cod_procedimento_'+pLinha;
    sChamada += '&txt_nome_campo_desc=nome_item_'+pLinha;
    sChamada += '&abre_modal=S';
    sChamada += '&ind_autorizacao=S';
    sChamada += '&ind_exibe_pacotes=S';        
	sChamada += '&funcao_executar=CarregaProcedimentoPesquisaGrid('+pLinha+')';

	AbrePesquisaCrossBrowser(sChamada, 'Pesquisa_Todos', 'Procedimento/Serviço', 700, 500, 20, 15, 'S')
}
//--------------------------------------------------------------------------------
function CarregaProcedimentoPesquisaGrid (pLinha){
	CarregaProcedimento(document.getElementById('cod_procedimento_'+pLinha).value ,pLinha);
}
//--------------------------------------------------------------------------------
function CarregaProcedimento(pCodProcedimento,pLinha,pTipo) {        
				
		aLinha = pLinha;
        document.getElementById('txt_msg').innerHTML = "";
        var v_cod_procedimento = pCodProcedimento;   	
        var cp = new cpaint();
        //cp.set_response_type('text');   
        cp.set_transfer_mode('get');
        cp.set_debug(false);
		cp.set_async(false);		
        cp.call('../../rbm/asp/RBM1091c.asp', 'MontaProcedimento', ExibeProcedimento, pLinha,v_cod_procedimento,pTipo);
        cp = null;

}
//-------------------------------------------------------------------------------------------

function GeraRelatorio() {
		document.form01.action = 'rbm1091c.asp?pt=<%Response.Write txt_subtitulo%>';
		document.form01.submit();
}
	
function ExibeProcedimento(pXML) {
	
	//Ler o XML.
    var tabela = pXML.ajaxResponse[0].find_item_by_id('resultado', 'tabela');
	
    if (tabela.eof[0].data == "N") {
		
		if (tabela.indLinha[0].data == "") {
			document.getElementById('item_medico').value = tabela.codigo[0].data;
			document.getElementById('nome_item_medico').value = tabela.descricao[0].data;
		} else {
			document.getElementById('cod_procedimento_'+tabela.indLinha[0].data).value = tabela.codigo[0].data;
			document.getElementById('nome_item_'+tabela.indLinha[0].data).value = tabela.descricao[0].data;
		}
		
	} else {	
		document.getElementById('txt_msg').innerHTML = 'Procedimento não encontrado';
        document.getElementById('txt_msg').style.display = '';
		
		if (tabela.indLinha[0].data == "") {
			document.getElementById('item_medico').value = '';
			document.getElementById('nome_item_medico').value = '';
		} else {
			document.getElementById('cod_procedimento_'+tabela.indLinha[0].data).value = '';
			document.getElementById('nome_item_'+tabela.indLinha[0].data).value = '';
		}
	}

    document.all["waitbar"].style.display = 'none';
}
function atualizaModalidade (pValor){

	var tipo = pValor;
	
	//form01.ind_tipo_reembolso.value;	
	carregaSubModalidade(tipo);
}


//--------------------------------------------------------------------------------------------
function carregaSubModalidade(tipo) {

	var ind_tipo;

	if (tipo.value == "" || typeof tipo.value === "undefined"){
		ind_tipo = tipo;		
	} else {
		ind_tipo = tipo.value;
	}	

	if (ind_tipo.value == "" ) {
		document.getElementById('trSubmodalidade').style.display='none';
		return false;
	}
	
	var cp = new cpaint();
	cp.set_transfer_mode('get');
	cp.set_response_type('text');
	cp.set_debug(false);
	cp.set_async(false);
	cp.call('../../rbm/asp/rbm0079f.asp', 'carregaSubModalidade', ExibeSubmodalidade, ind_tipo,"<%=ind_tipo_submodalidade_filtro%>","N"); 
}
//------------------------------------------------------------------
function ExibeSubmodalidade(pDescricao) {

	if (pDescricao=="-1") {
		document.getElementById('txt_msg').innerHTML="Não existe submodalidade para modalidade selecionada!";
		document.getElementById('txt_msg').style.display='';
		document.getElementById('trSubmodalidade').style.display='none';
	}else
		document.getElementById('trSubmodalidade').style.display='';
		document.getElementById('tdSubmodalidade').innerHTML=pDescricao;
}
//-----------------------------------------
function AdicionaLinhaProcedimento() {
	
	var iLinha,vTabela,vAcao;
	var vItem, vDescricao, vAlias, vAtendimento,vtxtConselho, vConselho;
	
	vtxtConselho    = "txt_conselho";
	vConselho       = "txt_xml_conselho";
		
	vTabela	= "TbParamPesquisa";
	vAcao = 'I';
	form01.qtd_param.value = parseInt(form01.qtd_param.value) + 1;
	iLinha 	= form01.qtd_param.value;

    var modalidade = form01.ind_tipo_reembolso.value;
    //INCLUIR NO GRID
    var aColunas = new Array();
    //var sLabel = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";

    //if (parseInt(iLinha) > 1)
    //    sLabel = "<B>OU</B>&nbsp;";

	sDescricao = "<input name='cod_procedimento_" + iLinha + "' tabIndex='1' id='cod_procedimento_" + iLinha + "' size=10 onkeydown='TeclaEnter();' onkeypress='javascript:MascInt()' onchange='CarregaProcedimento(this.value," + iLinha + ");' type='text'  maxLength='8' value=''/>";
    sDescricao += "<img id='Pesquisa_Item_Medido_p' style='display:; cursor:pointer;cursor:hand' name='Pesquisa_Procedimento' id='Pesquisa_Procedimento' width='16' height='16' src='/gen/mid/lupa.gif' border='0' title='Pesquisa Procedimentos/Serviços' onClick=\"javascript:PesquisaProcedimentoGrid('" + iLinha + "','"+modalidade+"');\">";

    //COD_PROCEDIMENTO
    var i = 0;
    aColunas[i] = sDescricao;
    
	//NOM_PROCEDIMENTO
    i += 1;
    aColunas[i] = "<input type='text' Readonly class=camposblocks id='nome_item_" + iLinha + "' name='nome_item_"+ iLinha + "'size=26'>";	

	//OPERADORA
    i += 1;
	MontaOperadora(iLinha,"", modalidade);
    aColunas[i] = cmbOperadora
	cmbOperadora = "";
	
	//MODALIDADE
    i += 1;
	MontaModalidade(iLinha,"", modalidade);
    aColunas[i] = cmbModalidade
	cmbModalidade = "";
	
	///SUBMODALIDADE
    i += 1;
	atualizaModalidadePesquisa("",iLinha);
    aColunas[i] = "<span id='dvSubmodalidade_"+iLinha+"' >"
    aColunas[i] += cmbSubModalidade
    aColunas[i] += "</span>"
	cmbSubModalidade = "";
	
	//ATENDIMENTO
    i += 1;
	MontaAtendimento(iLinha,"", modalidade);
	aColunas[i] = "<span id='dvAtendimento_"+iLinha+"' >"
    aColunas[i] += cmbAtendimento
	aColunas[i] += "</span>"
	cmbAtendimento = "";
	
	//Conselho
	i += 1;	
	MontaConselho(iLinha,"", modalidade);
    aColunas[i] = cmbConselho
	cmbConselho = "";
	
	//DATA INICIO
	i += 1;
	aColunas[i] = "<td class='grid_center' width='10%'><input type='text' onchange='validacaoDataInicio(this,"+iLinha+")' on maxLength='10' size='10' name='dt_inicio_" + iLinha + "' id='dt_inicio_" + iLinha + "' onKeyPress='javascript:MascData(\"dd/mm/yyyy\")'></td>";
	aColunas[i] += "<img src='/gen/img/img.gif' id='img_dt_inicio_"+ iLinha +"' style='cursor: pointer; border: 1px solid red;' title='Selecionar data' onmouseover='this.style.background=\"red\"' onmouseout='this.style.background=\"\"'/>";	

	//DATA FIM
	i += 1;
	aColunas[i] = "<td class='grid_center' width='10%'><input type='text' onchange='validacaoDataFim(this,"+iLinha+")' maxLength='10' size='12' name='dt_fim_" + iLinha + "' id='dt_fim_" + iLinha + "' onKeyPress='javascript:MascData(\"dd/mm/yyyy\")'>";
	aColunas[i] += "<img src='/gen/img/img.gif' id='img_dt_fim_"+ iLinha +"' style='cursor: pointer; border: 1px solid red;' title='Selecionar data' onmouseover='this.style.background=\"red\"' onmouseout='this.style.background=\"\"'/>";
	
	aColunas[i] += '<div id="div_data_' + iLinha + '" style="display:none"></div>';
	
	//IND ENVIO AUTOMATICO
	i += 1;
	aColunas[i] = "<td class='grid_center' ><select id='ind_automatizado_" + iLinha + "' name='ind_automatizado_" + iLinha + "' tabindex='1' style='width:80px' onchange='alteraPrazo(this,"+iLinha+")'>";
	aColunas[i] += "<option value='S'  tabindex='0'>Sim</option>";
	aColunas[i] += "<option value='N' selected>Não</option>";
	aColunas[i] += "</select>";
	
	//PRAZO DE ENVIO AUTOMATICO
    i += 1;
    aColunas[i] = "<td class='grid_center' width='5%'><input type='text' id='qtd_prazo_envio_" + iLinha + "' name='qtd_prazo_envio_"+ iLinha + "'size='5' onkeypress='javascript:MascInt()'></td>	";
	
	
    i += 1;
    aColunas[i] = "dias ";
	
	//NUM_SEQ_ITEM
    i += 1;
    aColunas[i] = "<input type='hidden' id='num_seq_item_" + iLinha + "' name='num_seq_item_"+ iLinha + "'value=''>";
    aColunas[i] = "<input type='hidden' id='dt_fim_antigo_" + iLinha + "' name='dt_fim_antigo_"+ iLinha + "'value=''>";
    aColunas[i] = "<input type='hidden' id='linhaAtual_" + iLinha + "' name='linhaAtual_"+ iLinha + "'value='"+ iLinha +"'>";
  /* 
	//FUNCAO
	if (pTipoModalidade == 3) {
		i += 1;
		aColunas[i] = '<a href="javascript:AbreItem('+form01.cod_grupo_regra_hdn.value+','+iLinha+');">Função</a>';
		aColunas[i] += "<input type='hidden' id='"+vFuncao+"_" +iLinha+ "' name='"+vFuncao+"_" +iLinha+ "' value=''>";
	}
	
	
	
    //Conselho
	if (pTipoModalidade == 2) {
		i += 1;
	
		sDescricao = "<input type='text' Readonly class=camposblocks id='"+vtxtConselho+"_" + iLinha + "' name='"+vtxtConselho+"_"+ iLinha + "' size='30'>";
		 aColunas[i] = sDescricao;
		 aColunas[i] += "<input type='hidden' id='"+vConselho+"_" +iLinha+ "' name='"+vConselho+"_" +iLinha+ "' value=''>";
		 i+=1;
		sDescricao = "<img id='Pesquisa_Conselho_p' style='display:; cursor:pointer;cursor:hand' name='Pesquisa_Conselho' id='Pesquisa_Conselho' width='16' height='16' src='/gen/mid/lupa.gif' border='0' title='Pesquisa Conselhos' onClick=\"javascript:AbreItemConselho('" +form01.cod_grupo_regra_hdn.value+"','" + iLinha + "');\">";
 	    aColunas[i] = sDescricao;
	}

	//EXCLUIR
	i += 1;
    aColunas[i] = "<input type='checkbox' id='"+vIndExc+"_" + iLinha + "' name='"+vIndExc+"_"+ iLinha + "' size='5' value='S'>";
	*/
    AddLinhaTabela(vTabela, aColunas);

    ConfiguraCalendario(iLinha); 
}	
//-----------------------------------------------------------------------------------
function AddLinhaTabela(pTabela, pColunas) {

    var table = document.all ? document.all[pTabela] : document.getElementById(pTabela);
    var row = table.insertRow(table.rows.length);
    var cell = null;
    for (var j = 0; j <= pColunas.length - 1; j++) {
        cell = row.insertCell(j);
        if (document.all)
            cell.innerHTML = pColunas[j];
        else
            cell.appendChild(document.createTextNode(pColunas[j]));
    }
}
//-----------------------------------------------------------------------------------
function MontaOperadora(pLinha, pValorDefault,pModalidade) {
    var cp = new cpaint();
    //cp.set_transfer_mode('get');
    cp.set_response_type('text');
    cp.set_debug(false);
    cp.set_async(false);
    //mLinha = pLinha;

    cp.call('../../rbm/asp/RBM1091c.asp', 'MontaComboOperadora', ExibeComboOperadora, pLinha, pValorDefault,pModalidade);

}

function ExibeComboOperadora(sDescricao) {
    cmbOperadora = sDescricao;

}
//-----------------------------------------------------------------------------------
function MontaModalidade(pLinha, pValorDefault,pModalidade) {
    var cp = new cpaint();

    //cp.set_transfer_mode('get');
    cp.set_response_type('text');
    cp.set_debug(false);
    cp.set_async(false);
    //mLinha = pLinha;

    cp.call('../../rbm/asp/RBM1091c.asp', 'MontaComboModalidade', ExibeComboModalidade, pLinha, pValorDefault,pModalidade);

}

function ExibeComboModalidade(sDescricao) {
    cmbModalidade = sDescricao;	
}
function atualizaModalidadePesquisa(pCodigo,pLinha){
	
	form01.linhaAtual.value = pLinha;
	
	var cp = new cpaint();
    cp.set_response_type('text');
    cp.set_debug(false);
    cp.set_async(false);
    cp.call('../../rbm/asp/RBM1091c.asp', 'CarregaSubModalidade', ExibeComboSubModalidade, pCodigo, pLinha);
}

function ExibeComboSubModalidade(sDescricao) {

	var linhaAtual = form01.linhaAtual.value;

	try{
		if (document.getElementById('ind_tipo_reembolso_'+linhaAtual).value == ""){
			cmbSubModalidade = sDescricao;	
		}else{
			document.getElementById('dvSubmodalidade_'+linhaAtual).innerHTML = sDescricao;
			MontaAtendimento(linhaAtual,'',document.getElementById('ind_tipo_reembolso_'+linhaAtual).value);
		}
	}catch(e){
		cmbSubModalidade = sDescricao;
	};
}

function MontaAtendimento(pLinha, pValorDefault,pModalidade) {
    var cp = new cpaint();
    //cp.set_transfer_mode('get');
    cp.set_response_type('text');
    cp.set_debug(false);
    cp.set_async(false);
    //mLinha = pLinha;

    cp.call('../../rbm/asp/RBM1091c.asp', 'MontaComboAtendimento', ExibeComboAtendimento, pLinha, pValorDefault,pModalidade);

}

function ExibeComboAtendimento(sDescricao) {

	var linhaAtual = form01.linhaAtual.value;

	try{
		if (document.getElementById('ind_tipo_reembolso_'+linhaAtual).value == ""){
			cmbAtendimento = sDescricao;
		}else{
			document.getElementById('dvAtendimento_'+linhaAtual).innerHTML = sDescricao;
		}
	}catch(e){
		cmbAtendimento = sDescricao;
	};
}

function MontaConselho(pLinha, pValorDefault,pModalidade) {
    var cp = new cpaint();
    //cp.set_transfer_mode('get');
    cp.set_response_type('text');
    cp.set_debug(false);
    cp.set_async(false);
    //mLinha = pLinha;

    cp.call('../../rbm/asp/RBM1091c.asp', 'MontaComboConselho', ExibeComboConselho, pLinha, pValorDefault,pModalidade);

}

function ExibeComboConselho(sDescricao) {
    cmbConselho = sDescricao;
}

function validacaoDataInicio(dtInicio, linha){    
    var dataInicio = dtInicio.value;
    var dataFim = document.getElementsByName("dt_fim_" + linha)[0];

    var dtIniAjust = converterData(dataInicio);
    var dataAjust = converterData(null);
    var dtFimAjust = converterData(dataFim.value);

	//Validação de data válida
	var partes = dataInicio.split("/");
	var dia = parseInt(partes[0],10);
	var mes = parseInt(partes[1],10) - 1;
	var ano = parseInt(partes[2],10);
	var data = new Date (ano, mes, dia);
	
	var dataValida = data.getDate() === dia && data.getMonth() === mes && data.getFullYear() === ano;
	
	if (!dataValida){
		alert("Data inválida!");
		dtInicio.value = "";
		return false;
	}
	
    if(dtIniAjust >= dtFimAjust ){
        alert("Data Início deve ser superior a Data Fim, favor validar.");
        dtInicio.value = "";
    }

    if(dtInicio.value.length >= 8 &&  dataAjust > dtIniAjust){
        alert("Permitido cadastrar data atual ou superior.");
        dtInicio.value = "";
    }
}

function validacaoDataFim(dtFim, linha){    
    var dataFim = dtFim.value;    
    var dataIni = document.getElementsByName("dt_inicio_" + linha)[0];

    var dtIniAjust = converterData(dataIni.value);
    var dtFimAjust = converterData(dataFim);
    var dataAjust = converterData(null);
	
	//Validação de data válida
	var partes = dataFim.split("/");
	var dia = parseInt(partes[0],10);
	var mes = parseInt(partes[1],10) - 1;
	var ano = parseInt(partes[2],10);
	var data = new Date (ano, mes, dia);
	
	var dataValida = data.getDate() === dia && data.getMonth() === mes && data.getFullYear() === ano;
	
	if (!dataValida){
		alert("Data inválida!");
		dataFim.value = "";
		return false;
	}
	
	if(dtFim.value.length >= 8 && dataAjust > dtFimAjust){
        alert("Permitido cadastrar data atual ou superior.");
        dtFim.value = "";
    }
	
    if(dtFim.value.length >= 8 &&  (dataAjust > dtFimAjust ||  dtIniAjust >= dtFimAjust)  ){
        alert("Data Fim não pode ser menor ou igual a Data Início.");
        dtFim.value = "";
    }
}

function converterData(data){
    var retornoData;

    if(data == null){
        var data = new Date();        

        var dia = data.getDate();
        var mes = data.getMonth() +1;
        var ano = data.getFullYear();
        retornoData = new Date(ano + '/'+ mes +'/'+dia)
    }
    else{
        var conversao = data.split("/");

        var dia = conversao[0];
        var mes = conversao[1];
        var ano = conversao[2];
        retornoData = new Date(ano + '/'+ mes +'/'+dia)
    }
    
    return retornoData;
}
function ConfiguraCalendario(pCont)
{
	
	var strHTML = '';

	strHTML += 'Calendar.setup({';
	strHTML += '	inputField     :    "dt_inicio_' + pCont + '",';
	strHTML += '	ifFormat       :    "%d/%m/%Y",';
	strHTML += '	button         :    "img_dt_inicio_' + pCont + '",';
	strHTML += '	align          :    "Tl",';
	strHTML += '	singleClick    :    true';
	strHTML += '});';
	strHTML += 'Calendar.setup({';
	strHTML += '	inputField     :    "dt_fim_' + pCont + '",';
	strHTML += '	ifFormat       :    "%d/%m/%Y",';
	strHTML += '	button         :    "img_dt_fim_' + pCont + '",';
	strHTML += '	align          :    "Tl",';
	strHTML += '	singleClick    :    true';
	strHTML += '});';

	eval('div_data_' + pCont + '.innerHTML = ' + strHTML);
}

function alteraPrazo(pCodigo,pLinha){

	if (pCodigo.value == "N") {
		document.getElementById('qtd_prazo_envio_'+pLinha).disabled = false;
	} else {
		document.getElementById('qtd_prazo_envio_'+pLinha).disabled = true;
	}
}

function validacaoDataInicioFiltro(dtInicio){    
    var dataInicio = dtInicio.value;
    var dataFim = document.getElementsByName("p_dt_fim")[0];

    var dtIniAjust = converterData(dataInicio);
    var dataAjust = converterData(null);
    var dtFimAjust = converterData(dataFim.value);

	//Validação de data válida
	var partes = dataInicio.split("/");
	var dia = parseInt(partes[0],10);
	var mes = parseInt(partes[1],10) - 1;
	var ano = parseInt(partes[2],10);
	var data = new Date (ano, mes, dia);
	
	var dataValida = data.getDate() === dia && data.getMonth() === mes && data.getFullYear() === ano;
	
	if (!dataValida){
		alert("Data inválida!");
		dtInicio.value = "";
		return false;
	}
	
    if(dtIniAjust >= dtFimAjust ){
        alert("Data Início deve ser superior a Data Fim, favor validar.");
        dtInicio.value = "";
    }

    if(dtInicio.value.length >= 8 &&  dataAjust > dtIniAjust){
        alert("Permitido cadastrar data atual ou superior.");
        dtInicio.value = "";
    }
}

function validacaoDataFimFiltro(dtFim){    
    var dataFim = dtFim.value;    
    var dataIni = document.getElementsByName("p_dt_ini")[0];

    var dtIniAjust = converterData(dataIni.value);
    var dtFimAjust = converterData(dataFim);
    var dataAjust = converterData(null);
	
	//Validação de data válida
	var partes = dataFim.split("/");
	var dia = parseInt(partes[0],10);
	var mes = parseInt(partes[1],10) - 1;
	var ano = parseInt(partes[2],10);
	var data = new Date (ano, mes, dia);
	
	var dataValida = data.getDate() === dia && data.getMonth() === mes && data.getFullYear() === ano;
	
	if (!dataValida){
		alert("Data inválida!");
		dataFim.value = "";
		return false;
	}
	
	if(dtFim.value.length >= 8 && dataAjust > dtFimAjust){
        alert("Permitido cadastrar data atual ou superior.");
        dtFim.value = "";
    }
	
    if(dtFim.value.length >= 8 &&  (dataAjust > dtFimAjust ||  dtIniAjust >= dtFimAjust)  ){
        alert("Data Fim não pode ser menor ou igual a Data Início.");
        dtFim.value = "";
    }
}
</script>

</head>

<body <%if ind_tipo_reembolso <> "" then%>onload="atualizaModalidade('<%=ind_tipo_reembolso%>');"<%end if%>>

<%AbreTable()%>
<font class="subtitulos"><%=txt_subtitulo%></font>
<%FechaTable()%>
<fieldset>
 <legend><b>Filtros</b></legend>

<div id="txt_msg" class="msg" align="center"><%=txt_msg%></div>

<form method="post" name="form01">

<table width="100%" align="center">
	
	<tr>
	    <td width="20%" class="label_right">&nbsp;Código&nbsp;</td>
	    <td>
	        <input name="item_medico" tabIndex="1" id="item_medico" onkeydown="TeclaEnter();" onkeypress="javascript:MascInt()" onchange="CarregaProcedimento(this.value,'');" type="text" size='10' maxLength='8' value=<%=cod_procedimento%>>
			<img id='Pesquisa_Item_Medido_p' style='display:; cursor:pointer;cursor:hand' name='Pesquisa_Procedimento' id='Pesquisa_Procedimento' width='16' height='16' src='/gen/mid/lupa.gif' border='0' title='Pesquisa Procedimentos/Serviços' onClick="javascript:PesquisaProcedimento();">
	    </td>
    </tr>   

    <tr>
		<td width="20%" class="label_right">&nbsp;Descrição&nbsp;</td>
		<td>
			<input type='text' Readonly class=camposblocks id='nome_item_medico' name="nome_item_medico" size='60' value="<%=nome_item%>">
		</td>
	</tr>

	<tr>
		<td nowrap class="label_right">Operadora&nbsp;</td>
		<td nowrap colspan="2">
			<%
			set rsCombo = retornaCursor("operadora","cod_operadora","nom_operadora","", "order by nom_operadora") 
			response.write montaCombo(rsCombo, "cod_operadora", cod_operadora,"","")
			%>
		</td>
	</tr>
	
	<tr>
		<td width="20%" class="label_right">&nbsp;Data Início&nbsp;</td>
		<td colspan="3">
			<input type="text" name="p_dt_ini" size="8" maxlength="10" onchange="validacaoDataInicioFiltro(this)" value="<%=dt_inicio%>" tabindex="<%=cInt(num_tabindex)+1%>" onKeyPress ="MascData('dd/mm/yyyy')">
			<img src="/gen/img/img.gif" id="img_pDtIni" style="cursor:pointer; border:1px solid red;" title="Selecionar data" onmouseover="this.style.background='red';" onmouseout="this.style.background=''">
			&nbsp;Data Fim&nbsp;
			<%num_tabindex = cint(num_tabindex) + 1%>
			<input type="text" name="p_dt_fim" size="8" maxlength="10" onchange="validacaoDataFimFiltro(this)" value="<%=dt_fim%>" tabindex="<%=cInt(num_tabindex)+1%>" onKeyPress ="MascData('dd/mm/yyyy')">
			<img src="/gen/img/img.gif" id="img_pDtFim" style="cursor:pointer; border:1px solid red;" title="Selecionar data" onmouseover="this.style.background='red';" onmouseout="this.style.background=''">
		</td>
	</tr>
	
	<tr>

		<td nowrap class="label_right">Modalidade&nbsp;</td>
		<td nowrap colspan="2">
			<%
			set rsCombo = retornaCursor("tipo_reembolso","ind_tipo_reembolso","nome_tipo_reembolso","", "order by ind_tipo_reembolso") 
			response.write montaCombo(rsCombo, "ind_tipo_reembolso", ind_tipo_reembolso, "atualizaModalidade(this)", "")
			%>	
		</td>
	</tr>

	<!---SUBMODALIDADE---->
	<tr id="trSubmodalidade" style="display: none;">
		<td width="20%" class="label_right">Submodalidade&nbsp;</td>
		<td nowrap colspan="3" id="tdSubmodalidade">	
			<select name="ind_tipo_submodalidade_filtro" id="ind_tipo_submodalidade_filtro" tabindex="0" >
			<option></option>
			</select>
			 
		</td>
	</tr>
	
</table>
<br>
<center>
	<input class="informacao" align="center" id="btnFiltrar" type="button" onclick="buscarFiltro();" value="      Filtrar      " style="cursor:hand" tabindex="1">
	<input id="ind_filtrar" name="ind_filtrar" type="hidden" value="">
	<input id="linhaAtual" name="linhaAtual" type="hidden" value="">
	<input type="hidden" name="txt_subtitulo" id="txt_subtitulo" value="<%=txt_subtitulo%>">
</center>
<br>
</fieldset>

<br>

<fieldset id="trServicos" style="display:'<% if trim(ind_filtrar) = "" then response.write "none" %>'">
	<legend><b>Serviços</b></legend>
	<table   width="100%" border="0" cellspacing="0" cellpadding="0" style="padding-top:10px;">
		<tr>
			<td><% Call Montaservicos()%></td>
		</tr>
	</table>
	
	<% if trim(qtd_param) = "" then qtd_param = "0" %>
	<input type="hidden" name="qtd_param" id="qtd_param" value="<%=qtd_param%>">
	
	<table width="100%" align="center">
	<tr>
		<td align="center" style="width: 100%;">
			<input class="informacao" style="cursor: hand" type="button" onClick="AdicionaLinhaProcedimento();" value="Adicionar Procedimento" id="button3" name="button2" tabindex="<%=cint(num_tabindex) + 1%>">
		</td>
	</tr>
</table>

</fieldset>

<table width="100%" border="0" id="faixaOcorrencia">
			<tr>
				<td class="grid_cabec" width="98%"><h1 class="grid_cabec"><label><font align="center" class="label_left"><b>&nbsp;Ocorrência</b></label></h1></td>				
			</tr>
		</table>
		<div id="dv_ocorrencia" >
			 <fieldset><% Call MontaOcorrencia()%></fieldset>
		</div>
		
</form>
<%
  'VOLTAR/CONTINUAR/LIMPAR/INCLUIR/ALTERAR/EXCLUIR/EXECUTAR/POPUP
  
    if Trim(ind_acao) = "I" then
		call MontaToolbar("S","N","S","S","N","N","N","N")
	elseif Trim(ind_acao) = "A" then
		call MontaToolbar("S","N","S","N","S","N","N","N")
	else
		call MontaToolbar("N","N","S","N","S","N","N","N")
		dim VetBotao(1)
		VetBotao(1) = "GeraRelatorio()|excel.gif|Exportar"
		session("VetBotaoExtra") = VetBotao
	end if

FechaTable()

%>
<script language=javascript>
	//CALENDARIO INICIO
	Calendar.setup({
	    inputField     :    "p_dt_ini",
		ifFormat       :    "%d/%m/%Y",
		button         :    "img_pDtIni",
		align          :    "Tl",
		singleClick    :    true
	});
	Calendar.setup({
	    inputField     :    "p_dt_fim",
		ifFormat       :    "%d/%m/%Y",
		button         :    "img_pDtFim",
		align          :    "Tl",
		singleClick    :    true
	});
	//CALENDARIO FIM
</script>
</body>
</html>
<%
Sub MontaCalendario(pCampo)%>
  <img src="/gen/img/img.gif" id="img_<%=pCampo%>" style="cursor: pointer; border: 1px solid red;" title="Selecionar data" onmouseover="this.style.background='red'" onmouseout="this.style.background=''" />
	<script>
		Calendar.setup({
			inputField     :    "<%=pCampo%>",
			ifFormat       :    "%d/%m/%Y",
			button         :    "img_<%=pCampo%>",
			align          :    "Tl",
			singleClick    :    true
		});
	</script>
<%End Sub
'------------------------------------------------------------------------------------------
function montaCombo(rsCombo, nome, valor, onChange, disabled)
	
	dim strCombo
	
	if disabled = "S" then
		txt_disabled = "readonly='readonly' class='camposblocks' disabled"
	else
		txt_disabled = disabled
	end if
	
	strCombo = ""
	
	strCombo = "<select id='" & nome & "' name='" & nome & "' onchange= '" &onChange & "' tabindex='0'  " & txt_disabled & ">"
	
	
	if nome = "cod_operadora" or Mid(nome,1,13) = "cod_operadora" then 
		strCombo = strCombo & "<option value=99>Todas</option>" & Chr(13) & Chr(10)
	else
		strCombo = strCombo & "<option></option>" & Chr(13) & Chr(10)
	end if
	
	do while not rsCombo.eof 
		if cstr(valor) = cstr(rsCombo(0)) then
			strCombo = strCombo & "<option value=" & rsCombo(0) & " selected>" & rsCombo(1) & "</option>" & Chr(13) & Chr(10)		
		else
			strCombo = strCombo & "<option value=" & rsCombo(0) & ">" & rsCombo(1) & "</option>" & Chr(13) & Chr(10)
		end if
		rsCombo.movenext
	loop

	strCombo = strCombo & "</select>" & Chr(13) & Chr(10)
	montaCombo = strCombo
end function
'------------------------------------------------------------------------------------------
function retornaCursor(p_nome_tabela, p_campo_value, p_campo_desc, p_where, p_order)
	'-----------------------------------------------------------------------
	'Montar combo da situação dos reembolsos
	'-----------------------------------------------------------------------
	Dim rsCombo
	Dim VetCombo(5,4)

	VetCombo(1, 1) = "IN"
	VetCombo(1, 2) = "adVarChar"
	VetCombo(1, 3) = "p_nome_tabela"
	VetCombo(1, 4) = p_nome_tabela

	VetCombo(2, 1) = "IN"
	VetCombo(2, 2) = "adVarChar"
	VetCombo(2, 3) = "p_campo_value"
	VetCombo(2, 4) = p_campo_value

	VetCombo(3, 1) = "IN"
	VetCombo(3, 2) = "adVarChar"
	VetCombo(3, 3) = "p_campo_desc"
	VetCombo(3, 4) = p_campo_desc

	VetCombo(4, 1) = "IN"
	VetCombo(4, 2) = "adVarChar"
	VetCombo(4, 3) = "p_order"
	VetCombo(4, 4) = p_order
	
	VetCombo(5, 1) = "IN"
	VetCombo(5, 2) = "adVarChar"
	VetCombo(5, 3) = "p_where"
	VetCombo(5, 4) = p_where

	Set rsCombo =  rsCursorOracle (	CStr(Session("ace_usuario")),_
									CStr(Session("ace_senha")),_
									CStr(Session("ace_ip")),_
									CStr(Session("ace_sistema")),_
									CStr(Session("ace_modulo")),_
									"RB_REEMBOLSO.RetornaCursor", _
									VetCombo, _
									false )
	


	set retornaCursor = rsCombo			
end function
'------------------------------------------------------------------------------------------
Private Sub MontaOcorrencia()

	dim qtd_ocorrencia
    %>
	
    	<fieldset>
			<table border="0" width="100%" align="center" id="tblOcorrencia">
				<tr>
					<td class="grid_cabec" width="25%" align="center"><b>Data</td>
					<td class="grid_cabec" width="55%" align="center"><b>Descrição</td>
					<td class="grid_cabec" width="20%" align="center"><b>Usuário</td>
				</tr>
				<%
				qtd_ocorrencia = 0
					'---------------------
					'CARREGAR AS OCORRENCIAS
					'---------------------
					Redim vet_PL(1, 4)
					vet_PL(1, 1) = "IN"
					vet_PL(1, 2) = "adDouble"
					vet_PL(1, 3) = "p_cod_grupo_regra"
					vet_PL(1, 4) = 1

					Set rsPesquisa = rsCursorOracle(CStr(Session("ace_usuario")),_
													CStr(Session("ace_senha")),_
													CStr(Session("ace_ip")),_
													CStr(Session("ace_sistema")),_
													CStr(Session("ace_modulo")),_
													"RBM_AUTOMATIZACAO_PREVIA.get_ocorrencia", _
													vet_PL, _
													false )
					do while not rsPesquisa.eof 
						qtd_ocorrencia = Cint(qtd_ocorrencia) + 1					
						%>
						<tr>
							<td align="center">								
								<%=rsPesquisa("dt_ocorrencia")%>
							</td>
							<td align="center">								
								<%=rsPesquisa("desc_ocorrencia")%>
							</td>
							<td align="center">								
								<%=rsPesquisa("cod_usuario")%>
							</td>							
						</tr>
						<% rsPesquisa.movenext
					loop
				rsPesquisa.close
				set rsPesquisa = nothing
				%>
			</table>
		<center>
		
        <input type="hidden" name="qtd_tblOcorrencia" value="0" />
		</center>
	</fieldset>	
	
	
<% End Sub 
Private Sub Montaservicos()

  Dim ind_hidden,pCont,pContGrd

  %>

  <table align="center" border="0" width="100%" id="TbParamPesquisa">
		<tr>
			<td style="width:8%" class="grid_cabec" align="center"><b>Código</b></td>
			<td style="width:15%" class="grid_cabec" align="center"><b>Descrição</b></td>
			<td style="width:8%" class="grid_cabec" align="center"><b>Operadora</b></td>
			<td style="width:8%" class="grid_cabec" align="center"><b>Modalidade</b></td>
			<td style="width:8%" class="grid_cabec" align="center"><b>Submodalidade</b></td>
			<td style="width:11%" class="grid_cabec" align="center"><b>Tipo Atendimento</b></td>
			<td style="width:10%" class="grid_cabec" align="center"><b>Sigla Conselho</b></td>
			<td style="width:10%" class="grid_cabec" align="center"><b>Dt. Inicio</b></td>
			<td style="width:10%" class="grid_cabec" align="center"><b>Dt. Fim</b></td>
			<td style="width:5%" class="grid_cabec" align="center"><b>Automatizado</b></td>
			<td style="width:5%" class="grid_cabec" align="center"><b>Prazo envio automatizado</b></td>
			<td style="width:5%" align="center">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
		</tr>
  <%
	pCont = 0
	
	dim vet_PL(6, 4), sDisplayDesabilitado
	dim v_ind_tipo_reembolso, v_ind_tipo_submodalidade, v_cod_tratamento, v_sigla_conselho
	dim v_txt_tipo_reembolso, v_txt_ind_tipo_submodalidade, v_txt_cod_tratamento, v_txt_sigla_conselho
	
	vet_PL(1, 1) = "IN"
    vet_PL(1, 2) = "adVarchar"
    vet_PL(1, 3) = "p_cod_procedimento"
    vet_PL(1, 4) = cod_procedimento
	
	vet_PL(2, 1) = "IN"
    vet_PL(2, 2) = "adVarchar"
    vet_PL(2, 3) = "p_cod_operadora"
    vet_PL(2, 4) = cod_operadora
	
	vet_PL(3, 1) = "IN"
    vet_PL(3, 2) = "adVarchar"
    vet_PL(3, 3) = "p_ind_tipo_reembolso"
    vet_PL(3, 4) = ind_tipo_reembolso
	
	vet_PL(4, 1) = "IN"
    vet_PL(4, 2) = "adVarchar"
    vet_PL(4, 3) = "p_ind_tipo_submodalidade"
    vet_PL(4, 4) = ind_tipo_submodalidade_filtro
	
	vet_PL(5, 1) = "IN"
    vet_PL(5, 2) = "adVarchar"
    vet_PL(5, 3) = "p_dt_inicio"
    vet_PL(5, 4) = dt_inicio
	
	vet_PL(6, 1) = "IN"
    vet_PL(6, 2) = "adVarchar"
    vet_PL(6, 3) = "p_dt_fim"
    vet_PL(6, 4) = dt_fim

	set rsPesquisa = rsCursorOracle( CStr(txt_usuario),_
									 CStr(txt_senha),_
									 CStr(txt_ip),_
									 CStr(txt_sistema),_
									 CStr(txt_modulo),_
									 "RBM_AUTOMATIZACAO_PREVIA.get_lista_param",_
									 vet_PL,_
									 false )			
	pCont = qtd_param
	
	do while not rsPesquisa.eof
    pCont = pCont + 1
    pContGrd = CInt(pContGrd) + 1
	
	if rsPesquisa("ind_tipo_reembolso") = ""  or IsNull(rsPesquisa("ind_tipo_reembolso"))then
		v_ind_tipo_reembolso = ""
	else 
		v_ind_tipo_reembolso = rsPesquisa("ind_tipo_reembolso")
	end if
	
	if rsPesquisa("ind_tipo_submodalidade") = "" or IsNull(rsPesquisa("ind_tipo_submodalidade")) then
		v_ind_tipo_submodalidade = ""
	else 
		v_ind_tipo_submodalidade = rsPesquisa("ind_tipo_submodalidade")
	end if
	
	if IsNull(rsPesquisa("cod_tratamento")) or rsPesquisa("cod_tratamento") = "" then
		v_cod_tratamento = ""
	else 
		v_cod_tratamento = rsPesquisa("cod_tratamento")
	end if
	
	if IsNull(rsPesquisa("sigla_conselho")) or rsPesquisa("sigla_conselho") = "" then
		v_sigla_conselho = ""
	else 
		v_sigla_conselho = rsPesquisa("sigla_conselho")
	end if
	
	if rsPesquisa("dt_ini_vigencia") <> "" then
		sDisplayDesabilitado = "readonly='readonly' class='camposblocks' disabled "
	else
		sDisplayDesabilitado = ""
	end if
	v_txt_tipo_reembolso			= sDisplayDesabilitado&" style='width:100px'"
	v_txt_ind_tipo_submodalidade	= sDisplayDesabilitado&" style='width:98px'"
	v_txt_cod_tratamento			= sDisplayDesabilitado&" style='width:135px'"
	v_txt_sigla_conselho			= sDisplayDesabilitado&" style='width:125px'"
  %>
	<tr id=tr_param_<%=pCont%>>
		
		<input type="hidden" name="num_seq_item_<%=pCont%>" id="num_seq_item_<%=pCont%>" value="<%=rsPesquisa("NUM_SEQ_ITEM")%>">
	   <td class="grid_center" width="10%"> 
			<input type="text" name="cod_procedimento_<%=pCont%>" id="cod_procedimento_<%=pCont%>" value="<%=rsPesquisa("cod_procedimento")%>" size="10" tabindex="1" maxlength="10" OnKeyDown="TeclaEnter()" onkeypress="javascript:MascInt()" onchange='CarregaProcedimento(this.value,<%=pCont%>);'<%=sDisplayDesabilitado%>  >
			
			<% if IsNull(rsPesquisa("dt_ini_vigencia")) then%>
			<img id='Pesquisa_Item_Medido_p' style='display:; cursor:pointer;cursor:hand' name='Pesquisa_Procedimento' id='Pesquisa_Procedimento' width='16' height='16' src='/gen/mid/lupa.gif' border='0' title='Pesquisa Procedimentos/Serviços' onClick="javascript:PesquisaProcedimentoGrid(<%=pCont%>);">
			<%end if%>
			<input type="hidden" name="item_medico_<%=pCont%>" id="item_medico_<%=pCont%>" value="<%=rsPesquisa("cod_procedimento")%>">
	   </td>
	   
	   <td class="grid_center" width="15%"> 
			<input type="text" readonly="readonly" class="camposblocks"  name="nome_item_<%=pCont%>" id="nome_item_<%=pCont%>" value="<%=rsPesquisa("nome_item")%>" size="26" tabindex="1">
	   </td>
	   <td class="grid_center" width="8%"> 
			<%
			set rsCombo = retornaCursor("operadora","cod_operadora","nom_operadora","", "order by nom_operadora") 
			response.write montaCombo(rsCombo, "cod_operadora", rsPesquisa("cod_operadora"),"",sDisplayDesabilitado)			
			%>
	   </td>
	   <input type="hidden" name="cod_operadora_<%=pCont%>" value="<%=rsPesquisa("cod_operadora")%>" >
	   <td class="grid_center" width="8%"> 
			<%
			set rsCombo = retornaCursor("tipo_reembolso","ind_tipo_reembolso","nome_tipo_reembolso","", "order by nome_tipo_reembolso") 
			response.write montaCombo(rsCombo, "ind_tipo_reembolso", v_ind_tipo_reembolso,"",v_txt_tipo_reembolso)			
			%>
	   </td>
	   <input type="hidden" name="ind_tipo_reembolso_<%=pCont%>" value="<%=rsPesquisa("ind_tipo_reembolso")%>" >

	   <td class="grid_center" width="8%"> 
			<%
			set rsCombo = retornaCursor("reembolso_previa_submodalidade","ind_tipo_submodalidade","nome_submodalidade","", "order by nome_submodalidade") 
			response.write montaCombo(rsCombo, "ind_tipo_submodalidade", v_ind_tipo_submodalidade,"",v_txt_ind_tipo_submodalidade)			
			%>			
	   </td>
	   <input type="hidden" name="ind_tipo_submodalidade_<%=pCont%>" value="<%=rsPesquisa("ind_tipo_submodalidade")%>" >
	   
	   <td class="grid_center" width="11%"> 
			<%
			set rsCombo = retornaCursor("tipo_tratamento","cod_tratamento","nome_tratamento","", "order by nome_tratamento") 
			response.write montaCombo(rsCombo, "cod_tratamento", v_cod_tratamento,"",v_txt_cod_tratamento)			
			%>		
	   </td>
	   <input type="hidden" name="cod_tratamento_<%=pCont%>" value="<%=rsPesquisa("cod_tratamento")%>" >
	   
	    <td class="grid_center" width="10%"> 
			<%
			set rsCombo = retornaCursor("conselho_regional","distinct sigla_conselho sgc ","sigla_conselho","", "order by sigla_conselho") 
			response.write montaCombo(rsCombo, "sigla_conselho", v_sigla_conselho,"",v_txt_sigla_conselho)			
			%>
	   </td>
	   <input type="hidden" name="sigla_conselho_<%=pCont%>" value="<%=rsPesquisa("sigla_conselho")%>" >
	   
		<td class="grid_center" width="10%"> 
			<input type="text" <%=sDisplayDesabilitado%> onchange="validacaoDataInicio(this)" name="dt_inicio_<%=pCont%>" id="dt_inicio_<%=pCont%>" value="<%=rsPesquisa("dt_ini_vigencia")%>" size="10" tabindex="1" maxlength="10" OnKeyDown="TeclaEnter()" onKeyPress ="javascript:MascData('dd/mm/yyyy')">
	   </td>	
	   
		 <% if rsPesquisa("dt_fim_vigencia") <> "" then %>
		   <td class="grid_center" width="20%">
		   <input type="text" readonly="readonly" class="camposblocks" name="dt_fim_<%=pCont%>" id="dt_fim_<%=pCont%>" value="<%=rsPesquisa("dt_fim_vigencia")%>" size="10" tabindex="1" maxlength="10" OnKeyDown="TeclaEnter()" onChange="javascript:alterado(<%=pCont%>);" onKeyPress ="javascript:MascData('dd/mm/yyyy');">
		   <input type="hidden" name="ind_alterado_<%=pCont%>" value="N" >
		   </td>
	   <%else%>
		   <td class="grid_center" width="10%">
		   <input type="text" name="dt_fim_<%=pCont%>" id="dt_fim_<%=pCont%>" value="<%=rsPesquisa("dt_fim_vigencia")%>" size="10" tabindex="1" maxlength="10" OnKeyDown="TeclaEnter()" onChange="validacaoDataFim(this,<%=pCont%>) ; javascript:alterado(<%=pCont%>);" onKeyPress ="javascript:MascData('dd/mm/yyyy');">
		   <% Call MontaCalendario("dt_fim_"& pCont)%>
		   <input type="hidden" name="ind_alterado_<%=pCont%>" value="N" >
		   </td>
	   <%end if%>
	
		<input type="hidden" name="dt_fim_antigo_<%=pCont%>" id="dt_fim_antigo_<%=pCont%>" value="<%=rsPesquisa("dt_fim_vigencia")%>"> 		
		
		<td class="grid_center" width="5%"> 
			<select id="ind_automatizado_<%=pCont%>" name="ind_automatizado_<%=pCont%>" tabindex="0" <%=sDisplayDesabilitado%>>
			    <option value="S" <%if rsPesquisa("ind_automatizado") = "S" then %> selected <%end if%>tabindex="0">Sim</option>
			    <option value="N" <%if rsPesquisa("ind_automatizado") = "N" or IsNull(rsPesquisa("ind_automatizado")) then %> selected  <%end if%>>Não</option>
			</select>
	   </td>
	   
	   <td class="grid_center" width="5%"> 
			<input type="text" <%=sDisplayDesabilitado%>  name="qtd_prazo_envio_<%=pCont%>" id="qtd_prazo_envio_<%=pCont%>" value="<%=rsPesquisa("qtd_prazo_envio")%>" size="5" tabindex="1" onkeypress="javascript:MascInt()"> 
	   </td>
	   
	   <td class="grid_center" width="5%"> dias </td>
	   
	   
	</tr>
	<%
    rsPesquisa.movenext
    loop
    rsPesquisa.close
    set rsPesquisa = nothing
	
	qtd_param = pCont

    %>
	<br>

  </table>
	<br>

<% End Sub %>